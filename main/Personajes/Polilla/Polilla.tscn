[gd_scene load_steps=16 format=2]

[ext_resource path="res://assets/enemies/polilla.png" type="Texture" id=1]
[ext_resource path="res://main/Personajes/PersonajeBase.tscn" type="PackedScene" id=2]
[ext_resource path="res://main/SistemaDa√±o/Hurtbox.tscn" type="PackedScene" id=3]
[ext_resource path="res://main/Personajes/Polilla/estados/Idle.gd" type="Script" id=4]
[ext_resource path="res://main/Personajes/Caballero/estados/Stun.gd" type="Script" id=5]
[ext_resource path="res://main/Componentes/DropManager.gd" type="Script" id=6]
[ext_resource path="res://main/libs/DebugMonitor/DebugMonitor.tscn" type="PackedScene" id=10]
[ext_resource path="res://main/Personajes/Polilla/Polilla.gd" type="Script" id=11]
[ext_resource path="res://main/Personajes/Polilla/estados/Perseguir.gd" type="Script" id=15]
[ext_resource path="res://main/libs/HSM/StateMachine.gd" type="Script" id=16]
[ext_resource path="res://main/Componentes/Steering.gd" type="Script" id=17]

[sub_resource type="RectangleShape2D" id=4]

[sub_resource type="RectangleShape2D" id=3]

[sub_resource type="Animation" id=1]
length = 0.001
tracks/0/type = "value"
tracks/0/path = NodePath("Skin/Sprite:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 0,
"values": [ 0 ]
}

[sub_resource type="Animation" id=2]
resource_name = "loop"
length = 0.4
loop = true
tracks/0/type = "value"
tracks/0/path = NodePath("Skin/Sprite:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 0.1, 0.2, 0.3 ),
"transitions": PoolRealArray( 1, 1, 1, 1 ),
"update": 1,
"values": [ 0, 1, 2, 3 ]
}

[node name="Polilla" instance=ExtResource( 2 )]
collision_layer = 4
collision_mask = 5
script = ExtResource( 11 )
skin = NodePath("Skin")
skin_sprite_path = NodePath("Skin/Sprite")
aceleracion = 10.0
friccion = 0.8
max_velocidad_horizontal = 120.0
max_velocidad_vertical = 120.0
fsm = NodePath("StateMachine")
hurtbox = NodePath("Hurtbox")

[node name="DropManager" type="Node" parent="." index="0"]
script = ExtResource( 6 )

[node name="monitores" type="Node2D" parent="." index="1"]
visible = false

[node name="estado" parent="monitores" index="0" instance=ExtResource( 10 )]
position = Vector2( 0, -24 )
monitor_target_property = "state"
monitor_flavor_text = "estado"

[node name="input" parent="monitores" index="1" instance=ExtResource( 10 )]
position = Vector2( 0, -37 )
monitor_target_node = NodePath("../..")
monitor_target_property = "input"
monitor_flavor_text = "input"

[node name="Status" parent="." index="2"]
hp_max = 50
stun_threshold = 30

[node name="CollisionShape2D" type="CollisionShape2D" parent="." index="3"]
visible = false
shape = SubResource( 4 )
__meta__ = {
"_edit_lock_": true
}

[node name="Hitbox" parent="." index="4"]
visible = false

[node name="Hurtbox" parent="." index="5" instance=ExtResource( 3 )]
visible = false
collision_mask = 16
agente_dir = NodePath("..")
is_constant = true
dmg = 15
fuerza_retroceso = 150.0
dmg_tipo = 1

[node name="CollisionShape2D" type="CollisionShape2D" parent="Hurtbox" index="0"]
shape = SubResource( 3 )

[node name="Skin" type="Node2D" parent="." index="6"]

[node name="Sprite" type="Sprite" parent="Skin" index="0"]
texture = ExtResource( 1 )
hframes = 4

[node name="AnimationPlayer" type="AnimationPlayer" parent="Skin" index="1"]
root_node = NodePath("../..")
autoplay = "loop"
anims/RESET = SubResource( 1 )
anims/loop = SubResource( 2 )

[node name="StateMachine" type="Node" parent="." index="7"]
script = ExtResource( 16 )
initial_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateMachine" index="0"]
script = ExtResource( 4 )

[node name="Perseguir" type="Node" parent="StateMachine" index="1"]
script = ExtResource( 15 )
steering = NodePath("../../Steering")

[node name="Stun" type="Node" parent="StateMachine" index="2"]
script = ExtResource( 5 )
estado_salida = "Perseguir"

[node name="Steering" type="Node" parent="." index="8"]
script = ExtResource( 17 )
distancia_de_deteccion = 24.0
num_rayos = 16

[connection signal="muerto" from="." to="DropManager" method="drop"]
