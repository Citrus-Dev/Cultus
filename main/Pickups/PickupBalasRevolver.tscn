[gd_scene load_steps=9 format=2]

[ext_resource path="res://icon.png" type="Texture" id=1]
[ext_resource path="res://assets/objetos/bala_revolver.tres" type="Texture" id=2]
[ext_resource path="res://main/Pickups/PickupBalasBallesta.tscn::5" type="PackedScene" id=3]

[sub_resource type="GDScript" id=4]
script/source = "extends Casquillo

const SND_AGARRAR := preload(\"res://assets/sfx/ammo_pickup.wav\")

export (NodePath) var path_area
export (String) var nombre_bala
export (String) var mensaje
export (int) var cant_bala
export(bool) var no_desaparecer

onready var area = get_node(path_area)

func _ready():
	area.connect(\"body_entered\", self, \"agarrar\")


func proceso(delta):
	if !no_desaparecer and contador_lifetime < LIFETIME:
		modulate.a = curva_fade.interpolate(contador_lifetime / LIFETIME)
	
	if !no_desaparecer: contador_lifetime -= delta
	if contador_lifetime <= 0:
		call_deferred(\"free\")


func agarrar(_jug):
	Musica.hacer_sonido(SND_AGARRAR, global_position)
	
	var inv : InvBalas = _jug.controlador_armas.inv_balas
	var arma : Arma = _jug.controlador_armas.arma_actual
	
	if arma == null or inv == null: return
	
	inv.agregar_balas(cant_bala, nombre_bala)
	if arma.has_method(\"actualizar_medidor\"):
		arma.actualizar_medidor()
	
	LabelsPickup.agregar_mensaje(
		global_position,
		mensaje.format([str(cant_bala)], \"%cant%\")
	)
	
	call_deferred(\"free\")
"

[sub_resource type="Curve" id=3]
_data = [ Vector2( 0, 0 ), 0.0, 0.0, 0, 0, Vector2( 0.366129, 1 ), 0.0, 0.0, 0, 0, Vector2( 0.45, 0.315951 ), 0.0, 0.0, 0, 0, Vector2( 0.546774, 0.978528 ), 0.0, 0.0, 0, 0, Vector2( 0.65, 0.315951 ), 0.0, 0.0, 0, 0, Vector2( 0.708064, 1 ), 0.0, 0.0, 0, 0, Vector2( 1, 1 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="RectangleShape2D" id=1]

[sub_resource type="RectangleShape2D" id=2]
extents = Vector2( 6, 5.5 )

[sub_resource type="PackedScene" id=5]
_bundled = {
"conn_count": 0,
"conns": PoolIntArray(  ),
"editable_instances": [  ],
"names": PoolStringArray( "KinematicBody2D", "KinematicBody2D", "collision_layer", "collision_mask", "script", "extra_lifetime", "curva_fade", "path_area", "nombre_bala", "cant_bala", "Area2D", "Area2D", "collision_layer", "collision_mask", "CollisionShape2D", "CollisionShape2D", "shape", "CollisionShape2D", "CollisionShape2D", "shape", "Sprite", "Sprite", "texture" ),
"node_count": 5,
"node_paths": [ NodePath("."), NodePath("./Area2D"), NodePath("."), NodePath(".") ],
"nodes": PoolIntArray( -1, -1, 1, 0, -1, 8, 2, 0, 3, 1, 4, 2, 5, 3, 6, 4, 7, 5, 8, 6, 9, 7, 0, 1073741824, 0, 11, 10, -1, 2, 12, 8, 13, 9, 0, 1073741825, 0, 15, 14, -1, 1, 16, 10, 0, 1073741826, 0, 18, 17, -1, 1, 19, 11, 0, 1073741827, 0, 21, 20, -1, 1, 22, 12, 0 ),
"variants": [ 0, 513, SubResource( 4 ), 5.0, SubResource( 3 ), NodePath("Area2D"), "Pistola", 12, 0, 2, SubResource( 1 ), SubResource( 2 ), ExtResource( 1 ) ],
"version": 2
}

[node name="PickupBalasRevolver" instance=ExtResource( 3 )]
mensaje = "+%cant% balas de revolver"

[node name="Sprite" parent="." index="2"]
texture = ExtResource( 2 )
